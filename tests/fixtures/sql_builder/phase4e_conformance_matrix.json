{
  "version": "phase4e-v2",
  "scenarios": [
    {
      "parameters": [
        "risk",
        1
      ],
      "id": "exists_any_all",
      "sql": "SELECT \"u\".\"id\" FROM \"users\" AS \"u\" WHERE EXISTS (SELECT \"e\".\"user_id\" FROM \"events\" AS \"e\" WHERE (e.user_id = u.id)) AND \"u\".\"score\" >= ANY (SELECT \"value\" FROM \"thresholds\" WHERE \"category\" = $1) AND \"u\".\"score\" >= ALL (SELECT \"min_score\" FROM \"minima\" WHERE \"enabled\" = $2) ORDER BY \"u\".\"id\" ASC"
    },
    {
      "parameters": [
        "1970-01-01T00:00:00Z"
      ],
      "id": "expression_ordering",
      "sql": "SELECT \"d\".\"id\" FROM \"documents\" AS \"d\" ORDER BY \"d\".\"priority\" DESC NULLS LAST, COALESCE(\"d\".\"updated_at\", \"d\".\"created_at\", $1) ASC NULLS FIRST"
    },
    {
      "parameters": [
        "TX"
      ],
      "id": "lateral_join",
      "sql": "SELECT \"d\".\"id\", \"d\".\"state_code\" FROM \"dockets\" AS \"d\" LEFT JOIN LATERAL (SELECT \"e\".\"event_id\" FROM \"events\" AS \"e\" WHERE (e.docket_id = d.id) ORDER BY COALESCE(e.updated_at, e.created_at) DESC NULLS LAST LIMIT 1) AS \"le\" ON TRUE WHERE \"d\".\"state_code\" = $1 ORDER BY \"d\".\"id\" ASC"
    },
    {
      "parameters": [
        "queued"
      ],
      "id": "locking_skip_locked",
      "sql": "SELECT \"q\".\"id\" FROM \"queue_jobs\" AS \"q\" WHERE \"q\".\"state\" = $1 ORDER BY \"q\".\"id\" ASC LIMIT 1 FOR UPDATE OF \"q\" SKIP LOCKED"
    },
    {
      "parameters": [
        0,
        9,
        "queued",
        "2026-01-01T00:00:00Z",
        1,
        "2026-01-02T00:00:00Z",
        "done"
      ],
      "id": "postgres_upsert_expression",
      "sql": "INSERT INTO \"queue_jobs\" (\"attempt_count\", \"id\", \"state\", \"updated_at\") VALUES ($1, $2, $3, $4) ON CONFLICT (\"id\") DO UPDATE SET \"attempt_count\" = \"queue_jobs\".\"attempt_count\" + $5, \"state\" = EXCLUDED.state, \"updated_at\" = GREATEST(\"queue_jobs\".\"updated_at\", EXCLUDED.\"updated_at\", $6::text) WHERE \"queue_jobs\".\"state\" <> $7 RETURNING \"id\""
    },
    {
      "parameters": [
        "TX",
        "TX",
        1
      ],
      "id": "set_operation",
      "sql": "(SELECT \"doc_id\" FROM \"active_docs\" WHERE \"state_code\" = $1) UNION ALL (SELECT \"doc_id\" FROM \"archived_docs\" WHERE \"state_code\" = $2) EXCEPT (SELECT \"doc_id\" FROM \"blocked_docs\" WHERE \"block_flag\" = $3)"
    },
    {
      "parameters": [
        "untitled",
        "TX"
      ],
      "id": "template_select",
      "sql": "SELECT \"d\".\"id\", COALESCE(\"d\".\"title\", $1) AS \"display_title\" FROM \"documents\" AS \"d\" WHERE (\"d\".\"state_code\" = $2) ORDER BY COALESCE(\"d\".\"updated_at\", \"d\".\"created_at\") ASC NULLS LAST"
    },
    {
      "parameters": [
        8,
        "doc-002"
      ],
      "id": "tuple_cursor",
      "sql": "SELECT \"doc\".\"document_id\" FROM \"documents\" AS \"doc\" WHERE ((COALESCE(doc.manifest_order, 0), doc.document_id) > ($1, $2)) ORDER BY COALESCE(doc.manifest_order, 0) ASC NULLS LAST, \"doc\".\"document_id\" ASC"
    },
    {
      "parameters": [],
      "id": "window_named",
      "sql": "SELECT \"s\".\"user_id\", ROW_NUMBER() OVER \"score_win\" AS \"row_num\" FROM \"scores\" AS \"s\" WINDOW \"score_win\" AS (PARTITION BY \"s\".\"team_id\" ORDER BY \"s\".\"score\" DESC) ORDER BY \"s\".\"user_id\" ASC"
    }
  ]
}
